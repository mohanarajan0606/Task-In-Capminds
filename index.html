<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ajax Image Upload</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-image: url('images/backgroundimg.jpeg');
      background-size: cover;
    }
    .modal-header, .modal-footer {
      background: #f8f9fa;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h3 class="d-flex justify-content-center">Ajax Image Upload</h3>
    <button class="btn btn-success my-3 float-right" onclick="showModal()">Add</button>
    <div id="employeeTable" class="table-responsive"></div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="employeeModal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Upload Employee</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="hideModal()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="id" id="empId">
            <div class="form-group">
              <label>Employee Name</label>
              <input type="text" name="name" class="form-control" id="empName" required>
            </div>
            <div class="form-group">
              <label>Employee Logo</label>
              <input type="file" name="image" class="form-control-file" id="empImage">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Upload</button>
            <button type="button" class="btn btn-secondary" onclick="hideModal()">Close</button>
          </div>
        </div>
      </form>
    </div>
  </div>

<script>
let employeeModal;

document.addEventListener('DOMContentLoaded', function () {
  employeeModal = new bootstrap.Modal(document.getElementById('employeeModal'));
  loadEmployees();
});

function showModal(id = '', name = '') {
  document.getElementById('uploadForm').reset();
  document.getElementById('empId').value = id;
  document.getElementById('empName').value = name;
  employeeModal.show();
}

function hideModal() {
  employeeModal.hide();
}

document.getElementById('uploadForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "upload.php", true);
  xhr.onload = function () {
    alert(this.responseText);
    hideModal();
    loadEmployees();
  };
  xhr.send(formData);
});

function loadEmployees() {
  const xhr = new XMLHttpRequest();
  xhr.open("GET", "fetch.php", true);
  xhr.onload = function () {
    document.getElementById('employeeTable').innerHTML = this.responseText;
  };
  xhr.send();
}

function deleteEmployee(id) {
  if (confirm("Are you sure?")) {
    const xhr = new XMLHttpRequest();
    xhr.open("POST", "delete.php", true);
    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhr.onload = function () {
      alert(this.responseText);
      loadEmployees();
    };
    xhr.send("id=" + encodeURIComponent(id));
  }
}

function previewEmployee(id) {
  window.open('generate_pdf.php?id=' + id, '_blank');
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
